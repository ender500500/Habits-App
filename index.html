<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Habits</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Habits">

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
theme:{
extend:{
colors:{
appBg:'#090514',
cardBg:'#170b33',
primary:'#9d4edd',
textMain:'#f3e8ff',
textMuted:'#a78bfa'
}}}};
</script>

<style>
body{-webkit-user-select:none;user-select:none;}
::-webkit-scrollbar{display:none;}
</style>

</head>

<body class="bg-appBg text-textMain font-sans min-h-screen relative pb-20 overflow-x-hidden">

<header class="pt-12 pb-6 px-6 sticky top-0 bg-appBg/90 backdrop-blur-md z-10 flex justify-between items-center">
<h1 class="text-3xl font-bold tracking-tight">Habits</h1>
</header>

<main class="px-6 space-y-4" id="habit-list"></main>

<button onclick="prepareAdd()" class="fixed bottom-8 right-6 bg-primary text-white w-14 h-14 rounded-full flex items-center justify-center">
+
</button>

<div id="modal-overlay" onclick="closeAllModals()" class="fixed inset-0 bg-black/80 z-30 hidden"></div>

<div id="add-modal" class="fixed bottom-0 left-0 right-0 bg-cardBg rounded-t-3xl z-40 transform translate-y-full transition p-6">

<h2 id="modal-title" class="text-xl font-bold mb-4">New Habit</h2>

<input id="habit-name" placeholder="Habit Name" class="w-full bg-appBg border rounded-xl p-4 mb-4">

<textarea id="habit-desc" placeholder="Description" class="w-full bg-appBg border rounded-xl p-4 mb-4"></textarea>

<input type="number" id="habit-target" placeholder="Daily target (optional)" class="w-full bg-appBg border rounded-xl p-4 mb-4">

<div class="flex gap-4">
<button onclick="closeAllModals()" class="flex-1 py-4 bg-appBg border rounded-xl">Cancel</button>
<button onclick="saveHabitAction()" class="flex-1 py-4 bg-primary rounded-xl text-white">Save</button>
</div>

</div>

<script>

let habits = JSON.parse(localStorage.getItem('my_habits')) || [];
let editingHabitId=null;

function getTodayString(){
const d=new Date();
return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

function saveHabits(){
localStorage.setItem('my_habits',JSON.stringify(habits));
}

function renderHabits(){

const list=document.getElementById('habit-list');
list.innerHTML='';

if(habits.length===0){
list.innerHTML='<p class="text-textMuted text-center mt-10">No habits yet</p>';
return;
}

const today=getTodayString();

habits.forEach(h=>{

if(!Array.isArray(h.history))h.history=[];
if(typeof h.progress!=='number'||isNaN(h.progress))h.progress=0;

const done=h.history.includes(today);

const el=document.createElement('div');
el.className="bg-cardBg p-4 rounded-2xl flex items-center gap-4";

el.innerHTML=`

<button onclick="interactHabit('${h.id}')" class="border px-3 py-2 rounded">
${done?'âœ“':h.type==='counter'?`${h.progress}/${h.target}`:'â—‹'}
</button>

<div class="flex-1">

<div class="font-semibold">${h.name}</div>
${h.desc?`<div class="text-sm opacity-70">${h.desc}</div>`:''}

</div>

<button onclick="editHabit('${h.id}')">âœŽ</button>
<button onclick="deleteHabit('${h.id}')">ðŸ—‘</button>
`;

list.appendChild(el);

});
}

function prepareAdd(){
editingHabitId=null;
document.getElementById('modal-title').innerText="New Habit";
habit-name.value='';
habit-desc.value='';
habit-target.value='';
openModal();
}

function editHabit(id){

const h=habits.find(x=>x.id===id);
if(!h)return;

editingHabitId=id;

document.getElementById('modal-title').innerText="Edit Habit";
habit-name.value=h.name||'';
habit-desc.value=h.desc||'';
habit-target.value=h.target||'';

openModal();
}

/* ------------- FIXED SAVE FUNCTION ------------- */

function saveHabitAction(){

const name=habit-name.value.trim();
if(!name){alert("Enter a name");return;}

const desc=habit-desc.value.trim();
const targetVal=habit-target.value.trim();

const isCounter=targetVal!==''&&!isNaN(targetVal)&&Number(targetVal)>0;

if(editingHabitId){

const habit=habits.find(h=>h.id===editingHabitId);
if(!habit)return;

habit.name=name;
habit.desc=desc;
habit.type=isCounter?'counter':'boolean';
habit.target=isCounter?Number(targetVal):null;

/* IMPORTANT FIX */
if(isCounter){

// ensure numeric progress exists
habit.progress=(typeof habit.progress==='number'&&!isNaN(habit.progress))
?habit.progress:0;

}else{

// switching to boolean -> reset progress safely
habit.progress=0;

}

// ensure history exists
if(!Array.isArray(habit.history))habit.history=[];

}else{

habits.push({
id:Date.now().toString(),
name:name,
desc:desc,
type:isCounter?'counter':'boolean',
target:isCounter?Number(targetVal):null,
progress:0,
history:[],
lastUpdated:getTodayString()
});

}

saveHabits();
renderHabits();
closeAllModals();

}

/* ------------------------------------------------ */

function deleteHabit(id){
if(confirm("Delete habit?")){
habits=habits.filter(h=>h.id!==id);
saveHabits();
renderHabits();
}
}

function interactHabit(id){

const habit=habits.find(h=>h.id===id);
const today=getTodayString();

if(!habit)return;

if(!Array.isArray(habit.history))habit.history=[];
if(typeof habit.progress!=='number'||isNaN(habit.progress))habit.progress=0;

const done=habit.history.includes(today);

if(habit.type==='boolean'){

if(done)habit.history=habit.history.filter(d=>d!==today);
else habit.history.push(today);

}else{

if(!done){

habit.progress++;

if(habit.progress>=habit.target)
habit.history.push(today);

}else{

habit.progress=0;
habit.history=habit.history.filter(d=>d!==today);

}

}

saveHabits();
renderHabits();

}

function openModal(){
modal-overlay.classList.remove('hidden');
add-modal.classList.remove('translate-y-full');
}

function closeAllModals(){
editingHabitId=null;
add-modal.classList.add('translate-y-full');
setTimeout(()=>modal-overlay.classList.add('hidden'),200);
}

renderHabits();

</script>

</body>
</html>
