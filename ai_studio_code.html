<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Basics & App Icon -->
    <title>Habits</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Habits">
    
    <!-- Custom White Checkmark on Midnight Purple App Icon (Base64 Encoded for immediate use) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzA5MDUxNCIvPjxwYXRoIGQ9Ik0yNSA1MCBsMTUgMTUgbDM1IC0zNSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjgiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        appBg: '#090514',       /* Deep Midnight Purple */
                        cardBg: '#170b33',      /* Rich Midnight Purple */
                        primary: '#9d4edd',     /* Vibrant Glowing Purple */
                        textMain: '#f3e8ff',    /* Soft white with a purple tint */
                        textMuted: '#a78bfa'    /* Muted purple */
                    }
                }
            }
        }
    </script>
    <style>
        body { -webkit-user-select: none; user-select: none; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
        .check-transition { transition: all 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-appBg text-textMain font-sans min-h-screen relative pb-20 overflow-x-hidden">

    <!-- Header -->
    <header class="pt-12 pb-6 px-6 sticky top-0 bg-appBg/90 backdrop-blur-md z-10">
        <h1 class="text-3xl font-bold tracking-tight">Habits</h1>
    </header>

    <!-- Habit List -->
    <main class="px-6 space-y-4" id="habit-list">
        <!-- Habits injected here by JS -->
    </main>

    <!-- Floating Add Button -->
    <button id="fab-add" class="fixed bottom-8 right-6 bg-primary text-white w-14 h-14 rounded-full shadow-[0_4px_20px_rgba(157,78,221,0.5)] flex items-center justify-center hover:scale-105 active:scale-95 transition-transform z-20">
        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
    </button>

    <!-- Dark Overlay for Menu -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/80 z-30 hidden transition-opacity"></div>

    <!-- Slide-up Menu (Bottom Sheet) -->
    <div id="add-modal" class="fixed bottom-0 left-0 right-0 bg-cardBg rounded-t-3xl z-40 transform translate-y-full transition-transform p-6 border-t border-primary/30 shadow-[0_-10px_40px_rgba(157,78,221,0.15)] max-h-[90vh] overflow-y-auto">
        <div class="w-12 h-1.5 bg-textMuted/30 rounded-full mx-auto mb-6"></div>
        
        <h2 class="text-xl font-bold mb-4">New Habit</h2>
        
        <input type="text" id="habit-name" placeholder="Habit Name (e.g., Drink Water)" class="w-full bg-appBg text-textMain border border-primary/30 rounded-xl p-4 mb-4 focus:outline-none focus:border-primary placeholder-textMuted/50">
        <textarea id="habit-desc" placeholder="Description or 'Why' (Optional)" rows="2" class="w-full bg-appBg text-textMain border border-primary/30 rounded-xl p-4 mb-4 focus:outline-none focus:border-primary placeholder-textMuted/50"></textarea>
        
        <!-- NEW: Number Target Input -->
        <div class="bg-appBg border border-primary/30 rounded-xl p-4 mb-6">
            <label class="block text-sm text-textMuted mb-2">Daily Target Number (Optional)</label>
            <input type="number" id="habit-target" placeholder="e.g. 8 (for 8 glasses), 30 (for 30g fiber)" class="w-full bg-transparent text-textMain focus:outline-none placeholder-textMuted/50 text-lg">
            <p class="text-xs text-textMuted/70 mt-2">Leave blank for a simple Yes/No checkbox.</p>
        </div>
        
        <div class="flex gap-4">
            <button id="btn-cancel" class="flex-1 py-4 rounded-xl font-semibold text-textMuted bg-appBg border border-primary/20 active:bg-primary/10">Cancel</button>
            <button id="btn-save" class="flex-1 py-4 rounded-xl font-semibold text-white bg-primary active:bg-primary/80">Save</button>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const modal = document.getElementById('add-modal');
        const overlay = document.getElementById('modal-overlay');
        const fab = document.getElementById('fab-add');
        const btnCancel = document.getElementById('btn-cancel');
        const btnSave = document.getElementById('btn-save');
        const inputName = document.getElementById('habit-name');
        const inputDesc = document.getElementById('habit-desc');
        const inputTarget = document.getElementById('habit-target');
        const habitList = document.getElementById('habit-list');

        let habits = JSON.parse(localStorage.getItem('my_habits')) || [];

        function getTodayString() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
        }

        function saveHabits() {
            localStorage.setItem('my_habits', JSON.stringify(habits));
        }

        // NEW: Checks if a new day has started and resets progress
        function checkDailyResets() {
            const today = getTodayString();
            let changed = false;
            habits.forEach(habit => {
                if (habit.lastUpdated !== today) {
                    habit.completedDate = null;
                    habit.progress = 0;
                    habit.lastUpdated = today;
                    changed = true;
                }
            });
            if (changed) saveHabits();
        }

        function renderHabits() {
            checkDailyResets();
            habitList.innerHTML = ''; 

            if (habits.length === 0) {
                habitList.innerHTML = '<p class="text-textMuted text-center mt-10">No habits yet. Tap + to add one!</p>';
                return;
            }

            habits.forEach(habit => {
                const isCounter = habit.type === 'counter';
                const isDone = isCounter ? habit.progress >= habit.target : habit.completedDate !== null;
                
                // Determine what goes inside the left circle
                let circleContent = '';
                if (isDone) {
                    circleContent = `<svg class="w-6 h-6 text-white check-transition" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>`;
                } else if (isCounter) {
                    circleContent = `<span class="text-sm font-bold">${habit.progress}<span class="text-[10px] text-textMuted/80">/${habit.target}</span></span>`;
                } else {
                    circleContent = `<svg class="w-6 h-6 text-primary opacity-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>`;
                }

                const habitEl = document.createElement('div');
                habitEl.className = `bg-cardBg p-4 rounded-2xl shadow-lg border ${isDone ? 'border-primary' : 'border-primary/20'} flex items-center gap-4 check-transition relative overflow-hidden`;
                
                // Progress bar background for counters
                let progressBg = '';
                if (isCounter && !isDone && habit.progress > 0) {
                    const percent = (habit.progress / habit.target) * 100;
                    progressBg = `<div class="absolute left-0 bottom-0 h-1 bg-primary/40 transition-all" style="width: ${percent}%"></div>`;
                }

                habitEl.innerHTML = `
                    ${progressBg}
                    <button onclick="interactHabit('${habit.id}')" class="w-12 h-12 rounded-full border-2 border-primary flex-shrink-0 flex items-center justify-center check-transition z-10 ${isDone ? 'bg-primary' : 'bg-transparent text-primary'} active:scale-90">
                        ${circleContent}
                    </button>
                    
                    <div class="flex-1 z-10 py-1" onclick="interactHabit('${habit.id}')">
                        <h2 class="text-lg font-semibold ${isDone ? 'text-textMuted line-through' : 'text-textMain'} check-transition">${habit.name}</h2>
                        ${habit.desc ? `<p class="text-textMuted text-sm leading-snug ${isDone ? 'opacity-50' : ''}">${habit.desc}</p>` : ''}
                    </div>
                    
                    <button onclick="deleteHabit('${habit.id}')" class="text-textMuted hover:text-red-400 p-2 z-10 active:scale-90 transition-transform flex-shrink-0">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                habitList.appendChild(habitEl);
            });
        }

        function addHabit() {
            const name = inputName.value.trim();
            const desc = inputDesc.value.trim();
            const targetVal = inputTarget.value.trim();
            
            if (!name) return; 

            const isCounter = targetVal !== '' && !isNaN(targetVal) && Number(targetVal) > 0;

            const newHabit = {
                id: Date.now().toString(),
                name: name,
                desc: desc,
                type: isCounter ? 'counter' : 'boolean',
                target: isCounter ? Number(targetVal) : null,
                progress: 0,
                completedDate: null,
                lastUpdated: getTodayString()
            };

            habits.push(newHabit);
            saveHabits();
            renderHabits();
            closeModal();
            
            inputName.value = '';
            inputDesc.value = '';
            inputTarget.value = '';
        }

        function deleteHabit(id) {
            if(confirm("Delete this habit?")) {
                habits = habits.filter(h => h.id !== id);
                saveHabits();
                renderHabits();
            }
        }

        window.deleteHabit = deleteHabit;
        
        // NEW: Handles both simple checkboxes and number counters
        window.interactHabit = function(id) {
            const today = getTodayString();
            const habit = habits.find(h => h.id === id);
            
            if (habit.type === 'boolean') {
                habit.completedDate = (habit.completedDate === today) ? null : today;
            } else if (habit.type === 'counter') {
                if (habit.progress < habit.target) {
                    habit.progress += 1;
                    if (habit.progress >= habit.target) {
                        habit.completedDate = today;
                    }
                } else {
                    // Reset if already done
                    habit.progress = 0;
                    habit.completedDate = null;
                }
            }
            
            habit.lastUpdated = today;
            saveHabits();
            renderHabits();
        }

        function openModal() {
            overlay.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('translate-y-full'), 10);
        }

        function closeModal() {
            modal.classList.add('translate-y-full');
            setTimeout(() => overlay.classList.add('hidden'), 300);
        }

        fab.addEventListener('click', openModal);
        btnCancel.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);
        btnSave.addEventListener('click', addHabit);

        renderHabits();
    </script>
</body>
</html>